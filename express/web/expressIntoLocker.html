<!DOCTYPE html>
<html>
<head>
    <title>快递入柜 -- 快件e栈服务平台</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <link href="css/normalize.css" type="text/css" rel="stylesheet" />
    <link href="css/common.css" type="text/css" rel="stylesheet" />
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <style type="text/css">
        .content{
            position: relative;
        }
        .expIntoLockerCont{
            padding: 20px;
        }
        .expIntoLockerCont .expIntoLockerIcon{
            width: 20%;
            margin: 0 auto 20px;
            text-align: center;
        }
        .expIntoLockerCont .expIntoLockerIcon p{
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
        }

        .submitBtn{
            width: 90%;
            margin: 20px auto 0;
            text-align: center;
            line-height: 46px;
            border-radius: 23px;
            background: #1f72ff;
            color: #fff;
            font-weight: bolder;
        }

        .result-info {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }
    </style>
</head>
<body>
<div class="content">
    <div class="headerNav">
        <div class="headerNavTop"><div class="headerNavIcon headerNavIconOut"><span></span><span></span></div></div>
        <div class="headerNavCont">
            <a href="index.html">快递首页</a>
            <a href="userhome.html">个人中心</a>
            <a href="delivery.html">送货上门</a>
            <a href="sendexpress.html">我要寄件</a>
            <a href="lazyboard.html">懒人排行</a>
            <a href="expassistant.html">快递助手</a>
        </div>
    </div>

    <div class="expIntoLockerCont">
        <div class="expIntoLockerIcon">
            <img src="images/expentericon.png" width="100%">
            <p>快递入柜</p>
        </div>
        
        <div class="expIntoLockerInput">
            <input id="PageContext" type="hidden" value="${pageContext.request.contextPath}" />
            <form>
                <div class="userInputCont">
                    <div class="inputTypeCont">
                        <div class="inputTitle">快递单号</div>
                        <input type="text" id="expressNumber" class="commonInputFunc" name="expressNumber" placeholder="请输入快递单号...">
                    </div>
                    <div class="inputTypeCont">
                        <div class="inputTitle">快递柜容量</div>
                        <select id="lockerSize" name="lockerSize">
                            <option value="小">小</option>
                            <option value="中" selected>中</option>
                            <option value="大">大</option>
                        </select>
                    </div>
                </div>
            </form>
            
            <div id="resultInfo"></div>
            
            <div class="submitBtn" id="submitBtn">快递入柜</div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function() {
        $('#submitBtn').on('click', function() {
            var expressNumber = $('#expressNumber').val().trim();
            var lockerSize = $('#lockerSize').val();

            // 验证代码...
            if (!expressNumber) {
                showResult('请输入快递单号', 'error');
                return;
            }

            var $btn = $(this);
            $btn.prop('disabled', true).text('处理中...');

            // 调用快递入柜API
            $.ajax({
                url: 'express/intoLocker.do',
                type: 'POST',
                data: {
                    expressNumber: expressNumber,
                    lockerSize: lockerSize
                },
                dataType: 'json',
                success: function(response) {
                    console.log('服务器响应:', response);

                    if (response.status === 0) {
                        // 检查data字段是否存在
                        if (response.data && response.data.lockerId) {
                            showResult('快递成功入柜！柜号：' + response.data.lockerId, 'success');
                        } else {
                            showResult('快递成功入柜！', 'success');
                        }
                        $('#expressNumber').val('');
                    } else {
                        showResult('入柜失败: ' + response.result, 'error');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('请求错误:', error);
                    showResult('网络错误，请检查网络连接后重试', 'error');
                },
                complete: function() {
                    $btn.prop('disabled', false).text('快递入柜');
                }
            });
        });

        // 显示结果信息
        function showResult(message, type) {
            var resultHtml = '<div class="result-info ' + type + '">' + message + '</div>';
            $('#resultInfo').html(resultHtml);
            
            // 3秒后自动清除结果信息
            setTimeout(function() {
                $('#resultInfo').html('');
            }, 3000);
        }
    });
</script>
</body>
</html>
