<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>åˆ é™¤å¿«é€’å‘˜</title>
    <link rel="stylesheet" type="text/css" href="../../css/reset.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/add.css"/>
</head>
<body>
<div id="app">
    <div class="header">
        <span>åˆ é™¤å¿«é€’å‘˜ä¿¡æ¯</span>
    </div>
    <div class="content">
        <table>
            <tr>
                <td class="text-right">æ‰‹æœºå·ç </td>
                <td class="content_right">
                    <input type="text" id="phone" class="input inline-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
                    <span class="btn btn-info" id="find">ç«‹å³æŸ¥æ‰¾</span>
                </td>
            </tr>
        </table>
    </div>

    <div class="header">
        <span>æŸ¥æ‰¾ä¿¡æ¯å¦‚ä¸‹</span>
    </div>
    <div class="content">
        <table>
            <tr>
                <td class="text-right">ç¼–å·</td>
                <td class="content_right" id="showId">-</td>
            </tr>
            <tr>
                <td class="text-right">å§“å</td>
                <td class="content_right" id="showName">-</td>
            </tr>
            <tr>
                <td class="text-right">æ‰‹æœºå·ç </td>
                <td class="content_right" id="showPhone">-</td>
            </tr>
            <tr>
                <td class="text-right">èº«ä»½è¯</td>
                <td class="content_right" id="showIdCard">******</td>
            </tr>
            <tr>
                <td class="text-right">æ´¾ä»¶æ•°</td>
                <td class="content_right" id="showDeliveryCount">-</td>
            </tr>
            <tr>
                <td class="text-right">æ³¨å†Œæ—¶é—´</td>
                <td class="content_right" id="showRegisterTime">-</td>
            </tr>
            <tr>
                <td></td>
                <td class="content_right">
                    <a href="list.html" class="btn btn-primary">è¿”å›åˆ—è¡¨</a>
                </td>
            </tr>
        </table>
    </div>
</div>

<div class="danger-zone" style="
    background: linear-gradient(135deg, #fff5f5 0%, #ffeaea 100%);
    border: 2px solid #f56565;
    border-radius: 12px;
    margin: 25px 0;
    padding: 25px;
    box-shadow: 0 4px 12px rgba(245, 101, 101, 0.15);
">
    <div style="
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #fed7d7;
    ">
        <div style="
            background: #f56565;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
        ">
            âš ï¸
        </div>
        <h3 style="
            margin: 0;
            color: #c53030;
            font-size: 18px;
            font-weight: 600;
        ">
            å±é™©æ“ä½œåŒºåŸŸ
        </h3>
    </div>

    <p style="
        color: #744210;
        margin-bottom: 20px;
        line-height: 1.5;
        font-size: 14px;
    ">
        <strong>è­¦å‘Šï¼š</strong>æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤å¿«é€’å‘˜æ•°æ®ï¼Œåˆ é™¤åæ— æ³•æ¢å¤ã€‚è¯·è°¨æ…æ“ä½œï¼
    </p>

    <div style="
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    ">
        <button onclick="manualTest()" style="
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(245, 101, 101, 0.4)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(245, 101, 101, 0.3)';">
            ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤
        </button>

        <button onclick="checkVariables()" style="
            background: #edf2f7;
            color: #4a5568;
            border: 1px solid #cbd5e0;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        " onmouseover="this.style.background='#e2e8f0';"
                onmouseout="this.style.background='#edf2f7';">
            ğŸ” æ£€æŸ¥ä¿¡æ¯
        </button>
    </div>

    <div id="debugInfo" style="
        margin-top: 20px;
        padding: 16px;
        background: white;
        border-radius: 8px;
        border: 1px solid #fed7d7;
        font-size: 13px;
        line-height: 1.4;
        display: none;
    ">
        <strong style="color: #744210;">æ“ä½œçŠ¶æ€ï¼š</strong>
        <span id="debugContent" style="margin-left: 8px;"></span>
    </div>
</div>

<script src="/qrcode/jquery2.1.4.js"></script>
<script src="/layer/layer.js"></script>
<script>
    $(".header:eq(1),.content:eq(1)").hide();
    var currentCourierId = null;

    // æ‰‹åŠ¨æµ‹è¯•å‡½æ•°
    function manualTest() {
        console.log("=== æ‰‹åŠ¨åˆ é™¤å¼€å§‹ ===");
        console.log("currentCourierId:", currentCourierId);

        if (currentCourierId) {
            console.log("å‘é€åˆ é™¤è¯·æ±‚...");
            $.getJSON("/courier/delete.do", {id: currentCourierId}, function(data){
                console.log("åˆ é™¤å“åº”:", data);
                alert("åˆ é™¤ç»“æœ: " + JSON.stringify(data));
            }).fail(function(xhr, status, error){
                console.error("åˆ é™¤å¤±è´¥:", status, error);
                alert("åˆ é™¤å¤±è´¥: " + status + ", " + error);
            });
        } else {
            alert("è¯·å…ˆæŸ¥æ‰¾å¿«é€’å‘˜ä¿¡æ¯");
        }
    }

    // æ£€æŸ¥å˜é‡å‡½æ•°
    function checkVariables() {
        console.log("=== å˜é‡æ£€æŸ¥ ===");
        console.log("currentCourierId:", currentCourierId);
        console.log("jQuery:", typeof $);
        console.log("layer:", typeof layer);
    }

    $(function(){
        console.log("DOMåŠ è½½å®Œæˆï¼Œç»‘å®šäº‹ä»¶...");

        $("#find").click(function(){
            console.log("æŸ¥æ‰¾æŒ‰é’®è¢«ç‚¹å‡»");
            var windowId = layer.load();
            var phone = $("#phone").val();
            console.log("æŸ¥æ‰¾æ‰‹æœºå·:", phone);

            $.getJSON("/courier/findByPhone.do", {phone: phone}, function(data){
                layer.close(windowId);
                console.log("æŸ¥æ‰¾å“åº”:", data);
                layer.msg(data.result);

                if(data.status == 0 && data.data) {
                    $(".header:eq(1),.content:eq(1)").fadeIn(1000);
                    currentCourierId = data.data.id;
                    console.log("è®¾ç½® currentCourierId:", currentCourierId);

                    $("#showId").text(data.data.id);
                    $("#showName").text(data.data.name);
                    $("#showPhone").text(data.data.phone);
                    $("#showDeliveryCount").text(data.data.deliveryCount || 0);
                    $("#showRegisterTime").text(data.data.registerTime || 'æ— ');
                }
            }).fail(function(xhr, status, error){
                layer.close(windowId);
                console.error("æŸ¥æ‰¾å¤±è´¥:", status, error);
                layer.msg('æŸ¥æ‰¾å¤±è´¥ï¼Œè¯·é‡è¯•');
            });
        });

        // ä¿®æ”¹åˆ é™¤æŒ‰é’®çš„äº‹ä»¶ç»‘å®šæ–¹å¼
        $(document).on('click', '#deleteBtn', function(){
            console.log("åˆ é™¤æŒ‰é’®è¢«ç‚¹å‡» - é€šè¿‡äº‹ä»¶å§”æ‰˜");
            if(!currentCourierId) {
                console.log("currentCourierId ä¸ºç©º");
                layer.msg('è¯·å…ˆæŸ¥æ‰¾å¿«é€’å‘˜ä¿¡æ¯');
                return;
            }

            var name = $("#showName").text();
            console.log("å‡†å¤‡åˆ é™¤å¿«é€’å‘˜ï¼ŒID:", currentCourierId, "å§“å:", name);

            layer.confirm('ç¡®å®šè¦åˆ é™¤å¿«é€’å‘˜ï¼š' + name + ' å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼', {
                icon: 3,
                title: 'åˆ é™¤ç¡®è®¤'
            }, function(index){
                console.log("ç”¨æˆ·ç¡®è®¤åˆ é™¤");
                layer.close(index);

                var windowId = layer.load();
                console.log("å‘é€AJAXè¯·æ±‚åˆ° /courier/delete.do");

                $.ajax({
                    url: "/courier/delete.do",
                    type: "GET",
                    data: {id: currentCourierId},
                    dataType: "json",
                    success: function(data) {
                        layer.close(windowId);
                        console.log("åˆ é™¤æˆåŠŸå“åº”:", data);
                        layer.msg(data.result);

                        if(data.status == 0) {
                            setTimeout(function(){
                                window.location.href = 'list.html';
                            }, 1500);
                        }
                    },
                    error: function(xhr, status, error) {
                        layer.close(windowId);
                        console.error("åˆ é™¤è¯·æ±‚å¤±è´¥:");
                        console.error("çŠ¶æ€:", status);
                        console.error("é”™è¯¯:", error);
                        console.error("å“åº”æ–‡æœ¬:", xhr.responseText);
                        layer.msg('åˆ é™¤å¤±è´¥: ' + error);
                    }
                });
            });
        });

        console.log("äº‹ä»¶ç»‘å®šå®Œæˆ");
    });
</script>
</body>
</html>